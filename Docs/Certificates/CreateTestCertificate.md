# Создание тестового УКЭП КриптоПро

УКЭП — это Усиленная Квалифицированная Электронная подпись. Она представляет собой файл сертификата и связанный с ним приватный ключ. Для выпуска тестового сертификата УКЭП потребуется плагин для браузера КриптоПро. Плагин потребуется для установки приватного ключа в защищенное хранилище ключей на вашем компьютере.

### 1. Тестовый УКЭП можно выпустить на сайте КриптоПро

https://www.cryptopro.ru/ui/Register/RegGetSubject.asp

Плагин КриптоПро устанавливается в разные браузеры, но конкретно эта страница для выпуска электронной подписы, похоже, работает только в Internet Explorer, поскольку там используется VBScript. Ошибку скрипт сообщит не на первой странице, а когда-нибудь потом, когда попытается зарегистрировать сертификат, и текст ошибки будет невнятным, про Internet Explorer там упоминания не будет. Просто имейте в виду, что в других браузерах страница регистрации не работает. 

Заполнять поля совсем уж мусором нежелательно, потому что при регистрации пользователя в ИС Честный знак потребуется соответствие полей Имя, Фамилия, Отчество и ИНН:

![Пример заполнения полей](https://github.com/yallie/MdlpClient/blob/master/Docs/Certificates/screenshots/01-PushkinCertificate.png?raw=true)

### 2. УКЭП выпускается в два этапа.

Заполняются поля, на следующей странице копируется маркер временного доступа и пароль:

![Маркер временного доступа](https://github.com/yallie/MdlpClient/blob/master/Docs/Certificates/screenshots/02-PushkinCertificate.png?raw=true)

### 3. Запрос на генерацию ключа

Если на этом этапе страница падает — значит, вы, вероятно проигнорировали требование использовать Internet Explorer. Страница обращается к плагину КриптоПро и запрашивает разрешение на выполнение операции плагина. Плагин должен выяснить, какие алгоритмы доступны на текущих установленных на вашей машине криптопровайдерах. Разрешение надо дать:

![Запрос сертификата](https://github.com/yallie/MdlpClient/blob/master/Docs/Certificates/screenshots/04-PushkinCertificate.png?raw=true)

### 4. Параметры УКЭП: алгоритм, разрядность

Для работы с тестовым стендом годится любой ключ и любой ГОСТ-овский алгоритм. Выбираете, нажимаете `Отправить`:

![Параметры](https://github.com/yallie/MdlpClient/blob/master/Docs/Certificates/screenshots/06-PushkinCertificate.png?raw=true)

### 5. Выбор хранилища для ключа

Плагин запросит, в какое хранилище поместить сгенерированный ключ. Ключ — вещь ответственная, поэтому он будет лежать в хранилище, защищенном с помощью пароля. Я рекомендую выбирать для верности реестр, оттуда ключ всегда можно будет экспортировать:

![Хранилище ключа](https://github.com/yallie/MdlpClient/blob/master/Docs/Certificates/screenshots/07-PushkinCertificate.png?raw=true)

### 6. Генерация ключа

Ключ представляет собой 512- или 1024-битное случайное число. Для его генерации не подойдет обычный генератор случайных чисел, поэтому при генерации ключа нужен дополнительный источник энтропии. Плагин КриптоПро попросит вас повозить и покликать по экрану мышкой, чтобы добавить эту случайную информацию во время генерации ключа:

![Генерация ключа](https://github.com/yallie/MdlpClient/blob/master/Docs/Certificates/screenshots/08-PushkinCertificate.png?raw=true)

### 7. Создание пароля

Ключ готов. Теперь этот ключ устанавливается в хранилище, которое будет защищено паролем. Требований к сложности пароля нет, для тестового УКЭП допустимо использовать простой пароль:

![Генерация ключа](https://github.com/yallie/MdlpClient/blob/master/Docs/Certificates/screenshots/09-PushkinCertificate.png?raw=true)

### 8. Установка сертификата в хранилище

Плагин снова запрашивает разрешение, теперь на установку сертификата. К сожалению, в окошке нет указаний, какой именно сертификат устанавливается. Видимо, имеется в виду только что созданный сертификат. Разрешаем:

![Установка сертификата](https://github.com/yallie/MdlpClient/blob/master/Docs/Certificates/screenshots/10-PushkinCertificate.png?raw=true)

### 9. Сертификат можно скачать

Добрались до страницы, на которой есть ссылки для скачивания и установки сертификата.
